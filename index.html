<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basketball Stats Tracker</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
const editGame = (game) => {
    setEditingGame(game);
    setView('editGame');
  };

  const saveEditedGame = () => {
    const updatedGames = games.map(g => g.id === editingGame.id ? editingGame : g);
    setGames(updatedGames);
    localStorage.setItem('basketballGames', JSON.stringify(updatedGames));
    setEditingGame(null);
    setView(selectedPlayer ? 'playerDetail' : 'teamDetail');
  };import React, { useState, useEffect, useRef } from 'react';
import { Plus, Play, Pause, ArrowLeft, Edit2, Trash2, Download, BarChart3, Users, UserPlus, Upload } from 'lucide-react';

const BasketballStatsTracker = () => {
  const [view, setView] = useState('home');
  const [teams, setTeams] = useState([]);
  const [games, setGames] = useState([]);
  const [currentGame, setCurrentGame] = useState(null);
  const [editingGame, setEditingGame] = useState(null);
  const [selectedTeam, setSelectedTeam] = useState(null);
  const [selectedPlayer, setSelectedPlayer] = useState(null);
  const [isPlaying, setIsPlaying] = useState(false);
  const [timeElapsed, setTimeElapsed] = useState(0);
  const [copiedGameId, setCopiedGameId] = useState(null);
  const [deleteConfirmId, setDeleteConfirmId] = useState(null);
  const [newTeamName, setNewTeamName] = useState('');
  const [newPlayerName, setNewPlayerName] = useState('');
  const [lastAction, setLastAction] = useState(null);
  const [formData, setFormData] = useState({
    date: new Date().toISOString().split('T')[0],
    time: new Date().toTimeString().slice(0, 5),
    teamId: '',
    playerId: '',
    opponent: ''
  });
  const timerRef = useRef(null);

  useEffect(() => {
    const savedTeams = localStorage.getItem('basketballTeams');
    const savedGames = localStorage.getItem('basketballGames');
    const savedCurrentGame = localStorage.getItem('currentGame');
    
    if (savedTeams) {
      setTeams(JSON.parse(savedTeams));
    }
    
    if (savedGames) {
      setGames(JSON.parse(savedGames));
    }
    
    if (savedCurrentGame) {
      const game = JSON.parse(savedCurrentGame);
      setCurrentGame(game);
      setTimeElapsed(game.stats.timePlayed || 0);
      setView('liveGame');
    }
  }, []);

  useEffect(() => {
    if (teams.length > 0) {
      localStorage.setItem('basketballTeams', JSON.stringify(teams));
    }
  }, [teams]);

  useEffect(() => {
    if (games.length > 0) {
      localStorage.setItem('basketballGames', JSON.stringify(games));
    }
  }, [games]);

  useEffect(() => {
    if (currentGame) {
      localStorage.setItem('currentGame', JSON.stringify(currentGame));
    }
  }, [currentGame]);

  useEffect(() => {
    if (isPlaying) {
      timerRef.current = setInterval(() => {
        setTimeElapsed(prev => {
          const newTime = prev + 1;
          if (currentGame) {
            setCurrentGame(prevGame => ({
              ...prevGame,
              stats: { ...prevGame.stats, timePlayed: newTime }
            }));
          }
          return newTime;
        });
      }, 1000);
    } else {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    }
    return () => {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    };
  }, [isPlaying, currentGame]);

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const createTeam = (teamName) => {
    const newTeam = {
      id: Date.now(),
      name: teamName,
      players: []
    };
    setTeams(prev => [...prev, newTeam]);
    return newTeam;
  };

  const addPlayerToTeam = (teamId, playerName) => {
    setTeams(prev => prev.map(team => {
      if (team.id === teamId) {
        const updatedTeam = {
          ...team,
          players: [...team.players, { id: Date.now(), name: playerName }]
        };
        // Update selectedTeam if it's the same team
        if (selectedTeam && selectedTeam.id === teamId) {
          setSelectedTeam(updatedTeam);
        }
        return updatedTeam;
      }
      return team;
    }));
  };

  const deleteTeam = (teamId) => {
    const updatedTeams = teams.filter(t => t.id !== teamId);
    const updatedGames = games.filter(g => g.teamId !== teamId);
    setTeams(updatedTeams);
    setGames(updatedGames);
    setDeleteConfirmId(null);
  };

  const deletePlayer = (teamId, playerId) => {
    setTeams(prev => prev.map(team => {
      if (team.id === teamId) {
        return {
          ...team,
          players: team.players.filter(p => p.id !== playerId)
        };
      }
      return team;
    }));
    const updatedGames = games.filter(g => g.playerId !== playerId);
    setGames(updatedGames);
    setDeleteConfirmId(null);
  };

  const getTeamRecord = (teamId) => {
    const teamGames = games.filter(g => g.teamId === teamId);
    return { total: teamGames.length };
  };

  const getTeamGames = (teamId) => {
    return games.filter(g => g.teamId === teamId);
  };

  const getPlayerGames = (playerId) => {
    return games.filter(g => g.playerId === playerId);
  };

  const startNewGame = (gameData) => {
    const team = teams.find(t => t.id === parseInt(gameData.teamId));
    const player = team?.players.find(p => p.id === parseInt(gameData.playerId));
    
    const newGame = {
      id: Date.now(),
      teamId: parseInt(gameData.teamId),
      playerId: parseInt(gameData.playerId),
      teamName: team?.name || '',
      playerName: player?.name || '',
      opponent: gameData.opponent,
      date: gameData.date,
      time: gameData.time,
      stats: {
        points: 0,
        freeThrowsMade: 0,
        freeThrowsMissed: 0,
        twoPointersMade: 0,
        twoPointersMissed: 0,
        threePointersMade: 0,
        threePointersMissed: 0,
        defensiveRebounds: 0,
        offensiveRebounds: 0,
        steals: 0,
        blocks: 0,
        turnovers: 0,
        fouls: 0,
        timePlayed: 0
      }
    };
    setCurrentGame(newGame);
    setTimeElapsed(0);
    setView('liveGame');
  };

  const updateStat = (statName, points = 0) => {
    setLastAction({ statName, points });
    setCurrentGame(prev => ({
      ...prev,
      stats: {
        ...prev.stats,
        [statName]: prev.stats[statName] + 1,
        points: prev.stats.points + points
      }
    }));
  };

  const undoLastAction = () => {
    if (!lastAction) return;
    
    setCurrentGame(prev => ({
      ...prev,
      stats: {
        ...prev.stats,
        [lastAction.statName]: prev.stats[lastAction.statName] - 1,
        points: prev.stats.points - lastAction.points
      }
    }));
    setLastAction(null);
  };

  const endGame = () => {
    if (isPlaying) setIsPlaying(false);
    const finishedGame = { ...currentGame };
    setGames(prev => [...prev, finishedGame]);
    
    // Navigate back to player detail view
    const team = teams.find(t => t.id === currentGame.teamId);
    const player = team?.players.find(p => p.id === currentGame.playerId);
    
    if (team && player) {
      setSelectedTeam(team);
      setSelectedPlayer(player);
      setView('playerDetail');
    } else {
      setView('home');
    }
    
    setCurrentGame(null);
    localStorage.removeItem('currentGame');
  };

  const deleteGame = (gameId) => {
    console.log('Deleting game:', gameId);
    console.log('Current games:', games);
    
    const updatedGames = games.filter(g => g.id !== gameId);
    console.log('Updated games:', updatedGames);
    
    setGames([...updatedGames]); // Force new array reference
    
    if (updatedGames.length > 0) {
      localStorage.setItem('basketballGames', JSON.stringify(updatedGames));
    } else {
      localStorage.removeItem('basketballGames');
    }
  };

  const editGame = (game) => {
    setEditingGame(game);
    setView('editGame');
  };

  const saveEditedGame = () => {
    const updatedGames = games.map(g => g.id === editingGame.id ? editingGame : g);
    setGames(updatedGames);
    localStorage.setItem('basketballGames', JSON.stringify(updatedGames));
    setEditingGame(null);
    setView(selectedPlayer ? 'playerDetail' : 'teamDetail');
  };

  const exportAllData = () => {
    const data = {
      teams: teams,
      games: games,
      exportDate: new Date().toISOString()
    };
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `basketball-stats-backup-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
  };

  const importAllData = (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.teams && data.games) {
          setTeams(data.teams);
          setGames(data.games);
          localStorage.setItem('basketballTeams', JSON.stringify(data.teams));
          localStorage.setItem('basketballGames', JSON.stringify(data.games));
          alert('Data imported successfully!');
          setView('home');
        } else {
          alert('Invalid backup file format');
        }
      } catch (error) {
        alert('Error reading backup file');
      }
    };
    reader.readAsText(file);
  };

  const exportGame = (game) => {
    const stats = game.stats;
    const fgMade = stats.twoPointersMade + stats.threePointersMade;
    const fgAttempted = stats.twoPointersMade + stats.twoPointersMissed + stats.threePointersMade + stats.threePointersMissed;
    const fgPct = fgAttempted > 0 ? ((fgMade / fgAttempted) * 100).toFixed(1) : 0;
    const ftPct = (stats.freeThrowsMade + stats.freeThrowsMissed) > 0 
      ? ((stats.freeThrowsMade / (stats.freeThrowsMade + stats.freeThrowsMissed)) * 100).toFixed(1) 
      : 0;

    const text = `üèÄ ${game.playerName} - ${game.teamName} vs ${game.opponent}
üìÖ ${game.date} ${game.time}

üìä STATS:
Points: ${stats.points}
FG: ${fgMade}/${fgAttempted} (${fgPct}%)
2PT: ${stats.twoPointersMade}/${stats.twoPointersMade + stats.twoPointersMissed}
3PT: ${stats.threePointersMade}/${stats.threePointersMade + stats.threePointersMissed}
FT: ${stats.freeThrowsMade}/${stats.freeThrowsMade + stats.freeThrowsMissed} (${ftPct}%)
Rebounds: ${stats.defensiveRebounds + stats.offensiveRebounds} (${stats.offensiveRebounds}O, ${stats.defensiveRebounds}D)
Steals: ${stats.steals}
Blocks: ${stats.blocks}
Turnovers: ${stats.turnovers}
Fouls: ${stats.fouls}
Time: ${formatTime(stats.timePlayed)}`;

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(() => {
        setCopiedGameId(game.id);
        setTimeout(() => setCopiedGameId(null), 2000);
      }).catch(() => {
        alert('Could not copy to clipboard. Stats:\n\n' + text);
      });
    } else {
      alert('Stats:\n\n' + text);
    }
  };

  const calculatePlayerStats = (playerId) => {
    const playerGames = getPlayerGames(playerId);
    if (playerGames.length === 0) return null;
    
    const totals = playerGames.reduce((acc, game) => {
      Object.keys(game.stats).forEach(key => {
        acc[key] = (acc[key] || 0) + game.stats[key];
      });
      return acc;
    }, {});

    const fgMade = totals.twoPointersMade + totals.threePointersMade;
    const fgAttempted = totals.twoPointersMade + totals.twoPointersMissed + totals.threePointersMade + totals.threePointersMissed;
    const ftAttempted = totals.freeThrowsMade + totals.freeThrowsMissed;
    const twoAttempted = totals.twoPointersMade + totals.twoPointersMissed;
    const threeAttempted = totals.threePointersMade + totals.threePointersMissed;

    return {
      gamesPlayed: playerGames.length,
      ppg: (totals.points / playerGames.length).toFixed(1),
      rpg: ((totals.defensiveRebounds + totals.offensiveRebounds) / playerGames.length).toFixed(1),
      fgPct: fgAttempted > 0 ? ((fgMade / fgAttempted) * 100).toFixed(1) : 0,
      twoPct: twoAttempted > 0 ? ((totals.twoPointersMade / twoAttempted) * 100).toFixed(1) : 0,
      threePct: threeAttempted > 0 ? ((totals.threePointersMade / threeAttempted) * 100).toFixed(1) : 0,
      ftPct: ftAttempted > 0 ? ((totals.freeThrowsMade / ftAttempted) * 100).toFixed(1) : 0,
      totalPoints: totals.points,
      totalRebounds: totals.defensiveRebounds + totals.offensiveRebounds,
      totalSteals: totals.steals,
      totalBlocks: totals.blocks
    };
  };

  // HOME VIEW
  if (view === 'home') {
    const hasGameInProgress = currentGame !== null;
    
    return (
      <div className="h-screen bg-gradient-to-br from-orange-500 to-red-600 p-4 flex items-center justify-center overflow-hidden">
        <div className="max-w-md mx-auto w-full">
          <div className="text-center text-white mb-6">
            <h1 className="text-3xl font-bold mb-2">üèÄ Stats Tracker</h1>
            <p className="text-orange-100">Track your basketball performance</p>
          </div>
          
          <div className="space-y-4">
            {hasGameInProgress && (
              <button
                onClick={() => setView('liveGame')}
                className="w-full bg-yellow-400 text-gray-900 rounded-xl p-5 font-bold text-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3 animate-pulse"
              >
                <Play size={28} />
                Resume Game in Progress
              </button>
            )}
            
            <button
              onClick={() => setView('teams')}
              className="w-full bg-white text-orange-600 rounded-xl p-5 font-bold text-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3"
            >
              <Users size={28} />
              Teams
            </button>
            
            <button
              onClick={() => setView('newGame')}
              className="w-full bg-white text-orange-600 rounded-xl p-5 font-bold text-xl shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3"
            >
              <Plus size={28} />
              New Game
            </button>

            <div className="grid grid-cols-2 gap-3 mt-6">
              <button
                onClick={exportAllData}
                className="bg-white bg-opacity-30 text-white rounded-lg p-3 font-semibold text-sm flex items-center justify-center gap-2"
              >
                <Download size={20} />
                Backup Data
              </button>
              <label className="bg-white bg-opacity-30 text-white rounded-lg p-3 font-semibold text-sm flex items-center justify-center gap-2 cursor-pointer">
                <input
                  type="file"
                  accept=".json"
                  onChange={importAllData}
                  className="hidden"
                />
                <Upload size={20} />
                Restore Data
              </label>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // TEAMS VIEW
  if (view === 'teams') {
    return (
      <div className="h-screen bg-gray-100 p-4 flex flex-col overflow-hidden">
        <div className="max-w-md mx-auto w-full flex flex-col h-full">
          <button
            onClick={() => setView('home')}
            className="text-orange-600 mb-4 flex items-center gap-2 font-semibold"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-2xl font-bold text-gray-800">Teams</h2>
            <button
              onClick={() => setView('createTeam')}
              className="bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2"
            >
              <Plus size={20} /> New Team
            </button>
          </div>
          
          {teams.length === 0 ? (
            <div className="bg-white rounded-xl p-8 text-center text-gray-500">
              No teams yet. Create your first team!
            </div>
          ) : (
            <div className="space-y-3 flex-1 overflow-y-auto">
              {teams.map((team) => {
                const record = getTeamRecord(team.id);
                return (
                  <div key={team.id} className="bg-white rounded-xl p-4 shadow">
                    <div className="flex justify-between items-center mb-2">
                      <div>
                        <h3 className="text-xl font-bold text-gray-800">{team.name}</h3>
                        <p className="text-sm text-gray-600">{record.total} games</p>
                        <p className="text-xs text-gray-500">{team.players.length} players</p>
                      </div>
                      <button
                        onClick={() => {
                          if (deleteConfirmId === 'team-' + team.id) {
                            deleteTeam(team.id);
                          } else {
                            setDeleteConfirmId('team-' + team.id);
                            setTimeout(() => setDeleteConfirmId(null), 3000);
                          }
                        }}
                        className={`${deleteConfirmId === 'team-' + team.id ? 'text-red-700' : 'text-red-500'} p-2`}
                      >
                        <Trash2 size={20} />
                      </button>
                    </div>
                    <button
                      onClick={() => {
                        setSelectedTeam(team);
                        setView('teamDetail');
                      }}
                      className="w-full bg-orange-600 text-white p-2 rounded-lg font-semibold mt-2"
                    >
                      View Team
                    </button>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    );
  }

  // CREATE TEAM VIEW
  if (view === 'createTeam') {
    return (
      <div className="h-screen bg-gradient-to-br from-orange-500 to-red-600 p-4 flex items-center justify-center overflow-hidden">
        <div className="max-w-md mx-auto w-full">
          <button
            onClick={() => setView('teams')}
            className="text-white mb-4 flex items-center gap-2"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-6 shadow-lg">
            <h2 className="text-2xl font-bold text-gray-800 mb-6">Create New Team</h2>
            
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">Team Name</label>
              <input
                type="text"
                value={newTeamName}
                onChange={(e) => setNewTeamName(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                placeholder="Enter team name"
              />
            </div>
            
            <button
              onClick={() => {
                if (newTeamName.trim()) {
                  createTeam(newTeamName);
                  setNewTeamName('');
                  setView('teams');
                }
              }}
              disabled={!newTeamName.trim()}
              className="w-full bg-orange-600 text-white rounded-lg p-4 font-bold text-xl disabled:bg-gray-300"
            >
              Create Team
            </button>
          </div>
        </div>
      </div>
    );
  }

  // TEAM DETAIL VIEW
  if (view === 'teamDetail' && selectedTeam) {
    const record = getTeamRecord(selectedTeam.id);
    const teamGames = getTeamGames(selectedTeam.id);
    
    return (
      <div className="h-screen bg-gray-100 p-4 flex flex-col overflow-hidden">
        <div className="max-w-md mx-auto w-full flex flex-col h-full">
          <button
            onClick={() => {
              setSelectedTeam(null);
              setView('teams');
            }}
            className="text-orange-600 mb-4 flex items-center gap-2 font-semibold"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-4 shadow mb-4">
            <h2 className="text-2xl font-bold text-gray-800">{selectedTeam.name}</h2>
            <p className="text-lg text-gray-600">{record.total} Games Played</p>
          </div>
          
          <div className="flex justify-between items-center mb-3">
            <h3 className="text-xl font-bold text-gray-800">Players</h3>
            <button
              onClick={() => setView('addPlayer')}
              className="bg-orange-600 text-white px-3 py-2 rounded-lg font-semibold flex items-center gap-2 text-sm"
            >
              <UserPlus size={18} /> Add Player
            </button>
          </div>
          
          {selectedTeam.players.length === 0 ? (
            <div className="bg-white rounded-xl p-6 text-center text-gray-500 mb-4">
              No players yet. Add your first player!
            </div>
          ) : (
            <div className="space-y-2 mb-4">
              {selectedTeam.players.map((player) => {
                const playerGames = getPlayerGames(player.id);
                const stats = calculatePlayerStats(player.id);
                
                return (
                  <div key={player.id} className="bg-white rounded-lg p-3 shadow">
                    <div className="flex justify-between items-center">
                      <div className="flex-1">
                        <h4 className="font-bold text-lg">{player.name}</h4>
                        {stats && (
                          <p className="text-sm text-gray-600">
                            {playerGames.length} games ‚Ä¢ {stats.ppg} PPG ‚Ä¢ {stats.rpg} RPG
                          </p>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => {
                            setSelectedPlayer(player);
                            setView('playerDetail');
                          }}
                          className="bg-blue-500 text-white px-3 py-2 rounded text-sm font-semibold"
                        >
                          View
                        </button>
                        <button
                          onClick={() => {
                            if (deleteConfirmId === 'player-' + player.id) {
                              deletePlayer(selectedTeam.id, player.id);
                            } else {
                              setDeleteConfirmId('player-' + player.id);
                              setTimeout(() => setDeleteConfirmId(null), 3000);
                            }
                          }}
                          className={`${deleteConfirmId === 'player-' + player.id ? 'text-red-700' : 'text-red-500'} p-2`}
                        >
                          <Trash2 size={18} />
                        </button>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          <h3 className="text-xl font-bold text-gray-800 mb-2">Team Game History</h3>
          
          {teamGames.length === 0 ? (
            <div className="bg-white rounded-xl p-6 text-center text-gray-500">
              No games played yet
            </div>
          ) : (
            <div className="space-y-2 flex-1 overflow-y-auto">
              {teamGames.map((game) => {
                const player = selectedTeam.players.find(p => p.id === game.playerId);
                return (
                  <div key={game.id} className="bg-white rounded-lg p-3 shadow">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <div className="font-bold">{player?.name || 'Unknown Player'}</div>
                        <div className="text-sm text-gray-600">vs {game.opponent}</div>
                        <div className="text-xs text-gray-500">{game.date}</div>
                      </div>
                      <div className="text-2xl font-bold text-orange-600">{game.stats.points}</div>
                    </div>
                    <div className="grid grid-cols-5 gap-1 text-center text-xs mb-2">
                      <div>
                        <div className="font-semibold">{game.stats.defensiveRebounds + game.stats.offensiveRebounds}</div>
                        <div className="text-gray-500">REB</div>
                      </div>
                      <div>
                        <div className="font-semibold">{game.stats.blocks}</div>
                        <div className="text-gray-500">BLK</div>
                      </div>
                      <div>
                        <div className="font-semibold">{game.stats.steals}</div>
                        <div className="text-gray-500">STL</div>
                      </div>
                      <div>
                        <div className="font-semibold">{game.stats.fouls}</div>
                        <div className="text-gray-500">FOULS</div>
                      </div>
                      <div>
                        <div className="font-semibold">{formatTime(game.stats.timePlayed)}</div>
                        <div className="text-gray-500">TIME</div>
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => exportGame(game)}
                        className={`flex-1 ${copiedGameId === game.id ? 'bg-green-600' : 'bg-green-500'} text-white p-2 rounded text-xs font-semibold flex items-center justify-center gap-1`}
                      >
                        <Download size={12} /> {copiedGameId === game.id ? 'Copied!' : 'Export'}
                      </button>
                      <button
                        onClick={() => {
                          if (window.confirm('Delete this game?')) deleteGame(game.id);
                        }}
                        className="flex-1 bg-red-500 text-white p-2 rounded text-xs font-semibold flex items-center justify-center gap-1"
                      >
                        <Trash2 size={12} /> Delete
                      </button>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    );
  }

  // ADD PLAYER VIEW
  if (view === 'addPlayer' && selectedTeam) {
    return (
      <div className="h-screen bg-gradient-to-br from-orange-500 to-red-600 p-4 flex items-center justify-center overflow-hidden">
        <div className="max-w-md mx-auto w-full">
          <button
            onClick={() => setView('teamDetail')}
            className="text-white mb-4 flex items-center gap-2"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-6 shadow-lg">
            <h2 className="text-2xl font-bold text-gray-800 mb-6">Add Player to {selectedTeam.name}</h2>
            
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">Player Name</label>
              <input
                type="text"
                value={newPlayerName}
                onChange={(e) => setNewPlayerName(e.target.value)}
                className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                placeholder="Enter player name"
              />
            </div>
            
            <button
              onClick={() => {
                if (newPlayerName.trim()) {
                  addPlayerToTeam(selectedTeam.id, newPlayerName);
                  setNewPlayerName('');
                  setView('teamDetail');
                }
              }}
              disabled={!newPlayerName.trim()}
              className="w-full bg-orange-600 text-white rounded-lg p-4 font-bold text-xl disabled:bg-gray-300"
            >
              Add Player
            </button>
          </div>
        </div>
      </div>
    );
  }

  // EDIT GAME VIEW
  if (view === 'editGame' && editingGame) {
    return (
      <div className="h-screen bg-gray-100 p-4 flex flex-col overflow-hidden">
        <div className="max-w-md mx-auto w-full flex flex-col h-full">
          <button
            onClick={() => {
              setEditingGame(null);
              setView(selectedPlayer ? 'playerDetail' : 'teamDetail');
            }}
            className="text-orange-600 mb-4 flex items-center gap-2 font-semibold"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-6 shadow-lg flex-1 overflow-y-auto">
            <h2 className="text-2xl font-bold text-gray-800 mb-4">Edit Game Stats</h2>
            <div className="text-sm text-gray-600 mb-6">
              {editingGame.playerName} vs {editingGame.opponent} ‚Ä¢ {editingGame.date}
            </div>
            
            <div className="space-y-4">
              {Object.entries(editingGame.stats).map(([key, value]) => (
                <div key={key} className="flex items-center justify-between">
                  <label className="text-sm font-medium text-gray-700 capitalize">
                    {key.replace(/([A-Z])/g, ' $1').trim()}
                  </label>
                  <input
                    type="number"
                    value={value}
                    onChange={(e) => setEditingGame(prev => ({
                      ...prev,
                      stats: { ...prev.stats, [key]: parseInt(e.target.value) || 0 }
                    }))}
                    className="w-20 p-2 border border-gray-300 rounded text-center"
                  />
                </div>
              ))}
            </div>
            
            <button
              onClick={saveEditedGame}
              className="w-full bg-orange-600 text-white rounded-lg p-4 font-bold text-lg mt-6 hover:bg-orange-700"
            >
              Save Changes
            </button>
          </div>
        </div>
      </div>
    );
  }

  // PLAYER DETAIL VIEW
  if (view === 'playerDetail' && selectedPlayer && selectedTeam) {
    const playerGames = getPlayerGames(selectedPlayer.id);
    const stats = calculatePlayerStats(selectedPlayer.id);
    
    return (
      <div className="h-screen bg-gray-100 p-4 flex flex-col overflow-hidden">
        <div className="max-w-md mx-auto w-full flex flex-col h-full">
          <button
            onClick={() => {
              setSelectedPlayer(null);
              setView('teamDetail');
            }}
            className="text-orange-600 mb-4 flex items-center gap-2 font-semibold"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-4 shadow mb-4">
            <div className="flex justify-between items-start">
              <div>
                <h2 className="text-2xl font-bold text-gray-800">{selectedPlayer.name}</h2>
                <p className="text-sm text-gray-600">{selectedTeam.name}</p>
              </div>
              <button
                onClick={() => {
                  setFormData({
                    ...formData,
                    teamId: selectedTeam.id.toString(),
                    playerId: selectedPlayer.id.toString()
                  });
                  setView('newGame');
                }}
                className="bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2"
              >
                <Plus size={18} /> New Game
              </button>
            </div>
          </div>
          
          {stats && (
            <div className="space-y-3 mb-4">
              <div className="bg-white rounded-xl p-4 shadow">
                <h3 className="font-bold mb-2">Averages</h3>
                <div className="grid grid-cols-3 gap-3 text-center">
                  <div>
                    <div className="text-2xl font-bold text-orange-600">{stats.ppg}</div>
                    <div className="text-xs text-gray-600">PPG</div>
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-orange-600">{stats.rpg}</div>
                    <div className="text-xs text-gray-600">RPG</div>
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-orange-600">{stats.gamesPlayed}</div>
                    <div className="text-xs text-gray-600">Games</div>
                  </div>
                </div>
              </div>
              
              <div className="bg-white rounded-xl p-4 shadow">
                <h3 className="font-bold mb-2">Shooting %</h3>
                <div className="grid grid-cols-4 gap-2 text-center text-sm">
                  <div>
                    <div className="font-bold text-orange-600">{stats.fgPct}%</div>
                    <div className="text-xs text-gray-600">FG</div>
                  </div>
                  <div>
                    <div className="font-bold text-orange-600">{stats.twoPct}%</div>
                    <div className="text-xs text-gray-600">2PT</div>
                  </div>
                  <div>
                    <div className="font-bold text-orange-600">{stats.threePct}%</div>
                    <div className="text-xs text-gray-600">3PT</div>
                  </div>
                  <div>
                    <div className="font-bold text-orange-600">{stats.ftPct}%</div>
                    <div className="text-xs text-gray-600">FT</div>
                  </div>
                </div>
              </div>
            </div>
          )}
          
          <h3 className="text-lg font-bold text-gray-800 mb-2">Game History</h3>
          
          {playerGames.length === 0 ? (
            <div className="bg-white rounded-xl p-6 text-center text-gray-500">
              No games played yet
            </div>
          ) : (
            <div className="space-y-2 flex-1 overflow-y-auto">
              {playerGames.map((game) => (
                <div key={game.id} className="bg-white rounded-lg p-3 shadow">
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <div className="font-bold">vs {game.opponent}</div>
                      <div className="text-xs text-gray-500">{game.date}</div>
                    </div>
                    <div className="text-2xl font-bold text-orange-600">{game.stats.points}</div>
                  </div>
                  <div className="grid grid-cols-5 gap-1 text-center text-xs mb-2">
                    <div>
                      <div className="font-semibold">{game.stats.defensiveRebounds + game.stats.offensiveRebounds}</div>
                      <div className="text-gray-500">REB</div>
                    </div>
                    <div>
                      <div className="font-semibold">{game.stats.blocks}</div>
                      <div className="text-gray-500">BLK</div>
                    </div>
                    <div>
                      <div className="font-semibold">{game.stats.steals}</div>
                      <div className="text-gray-500">STL</div>
                    </div>
                    <div>
                      <div className="font-semibold">{game.stats.fouls}</div>
                      <div className="text-gray-500">FOULS</div>
                    </div>
                    <div>
                      <div className="font-semibold">{formatTime(game.stats.timePlayed)}</div>
                      <div className="text-gray-500">TIME</div>
                    </div>
                  </div>
                  <div className="flex gap-1">
                    <button
                      onClick={() => editGame(game)}
                      className="flex-1 bg-blue-500 text-white p-2 rounded text-xs font-semibold flex items-center justify-center gap-1"
                    >
                      <Edit2 size={12} /> Edit
                    </button>
                    <button
                      onClick={() => exportGame(game)}
                      className={`flex-1 ${copiedGameId === game.id ? 'bg-green-600' : 'bg-green-500'} text-white p-2 rounded text-xs font-semibold flex items-center justify-center gap-1`}
                    >
                      <Download size={12} /> {copiedGameId === game.id ? 'Copied!' : 'Export'}
                    </button>
                    <button
                      onClick={() => {
                        if (deleteConfirmId === game.id) {
                          deleteGame(game.id);
                        } else {
                          setDeleteConfirmId(game.id);
                          setTimeout(() => setDeleteConfirmId(null), 3000);
                        }
                      }}
                      className={`flex-1 ${deleteConfirmId === game.id ? 'bg-red-700' : 'bg-red-500'} text-white p-2 rounded text-xs font-semibold flex items-center justify-center gap-1`}
                    >
                      <Trash2 size={12} /> {deleteConfirmId === game.id ? 'Confirm?' : 'Delete'}
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    );
  }

  // NEW GAME VIEW
  if (view === 'newGame') {
    return (
      <div className="h-screen bg-gradient-to-br from-orange-500 to-red-600 p-4 flex flex-col overflow-hidden">
        <div className="max-w-md mx-auto w-full flex flex-col h-full">
          <button
            onClick={() => setView('home')}
            className="text-white mb-4 flex items-center gap-2"
          >
            <ArrowLeft /> Back
          </button>
          
          <div className="bg-white rounded-xl p-6 shadow-lg flex-1 flex flex-col justify-center">
            <h2 className="text-2xl font-bold text-gray-800 mb-6">New Game</h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                <input
                  type="date"
                  value={formData.date}
                  onChange={(e) => setFormData({...formData, date: e.target.value})}
                  className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Time</label>
                <input
                  type="time"
                  value={formData.time}
                  onChange={(e) => setFormData({...formData, time: e.target.value})}
                  className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Team</label>
                {teams.length === 0 ? (
                  <button
                    onClick={() => setView('createTeam')}
                    className="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-orange-500 hover:text-orange-600"
                  >
                    + Create a team first
                  </button>
                ) : (
                  <select
                    value={formData.teamId}
                    onChange={(e) => setFormData({...formData, teamId: e.target.value, playerId: ''})}
                    className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                  >
                    <option value="">Select team</option>
                    {teams.map(team => (
                      <option key={team.id} value={team.id}>{team.name}</option>
                    ))}
                  </select>
                )}
              </div>
              
              {formData.teamId && (
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Player</label>
                  {teams.find(t => t.id === parseInt(formData.teamId))?.players.length === 0 ? (
                    <button
                      onClick={() => {
                        setSelectedTeam(teams.find(t => t.id === parseInt(formData.teamId)));
                        setView('addPlayer');
                      }}
                      className="w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-orange-500 hover:text-orange-600"
                    >
                      + Add a player to this team
                    </button>
                  ) : (
                    <select
                      value={formData.playerId}
                      onChange={(e) => setFormData({...formData, playerId: e.target.value})}
                      className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                    >
                      <option value="">Select player</option>
                      {teams.find(t => t.id === parseInt(formData.teamId))?.players.map(player => (
                        <option key={player.id} value={player.id}>{player.name}</option>
                      ))}
                    </select>
                  )}
                </div>
              )}
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Opponent</label>
                <input
                  type="text"
                  value={formData.opponent}
                  onChange={(e) => setFormData({...formData, opponent: e.target.value})}
                  className="w-full p-3 border border-gray-300 rounded-lg text-lg"
                  placeholder="Enter opponent name"
                />
              </div>
              
              <button
                onClick={() => startNewGame(formData)}
                disabled={!formData.teamId || !formData.playerId || !formData.opponent}
                className="w-full bg-orange-600 text-white rounded-lg p-4 font-bold text-xl disabled:bg-gray-300 disabled:cursor-not-allowed hover:bg-orange-700 transition mt-4"
              >
                Start Game
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // LIVE GAME VIEW
  if (view === 'liveGame' && currentGame) {
    const stats = currentGame.stats;
    const totalRebounds = stats.defensiveRebounds + stats.offensiveRebounds;
    const fgMade = stats.twoPointersMade + stats.threePointersMade;
    const fgAttempted = stats.twoPointersMade + stats.twoPointersMissed + stats.threePointersMade + stats.threePointersMissed;
    const fgPct = fgAttempted > 0 ? ((fgMade / fgAttempted) * 100).toFixed(0) : 0;
    const ftAttempted = stats.freeThrowsMade + stats.freeThrowsMissed;
    const ftPct = ftAttempted > 0 ? ((stats.freeThrowsMade / ftAttempted) * 100).toFixed(0) : 0;
    
    return (
      <div className="h-screen bg-gray-100 flex flex-col overflow-hidden">
        <div className="bg-orange-600 text-white p-3 shadow-lg">
          <div className="max-w-md mx-auto">
            <div className="grid grid-cols-4 gap-2 text-center mb-2">
              <div>
                <div className="text-2xl font-bold">{stats.points}</div>
                <div className="text-xs">PTS</div>
              </div>
              <div>
                <div className="text-2xl font-bold">{totalRebounds}</div>
                <div className="text-xs">REB</div>
              </div>
              <div>
                <div className="text-2xl font-bold">{stats.steals}</div>
                <div className="text-xs">STL</div>
              </div>
              <div>
                <div className="text-2xl font-bold">{stats.blocks}</div>
                <div className="text-xs">BLK</div>
              </div>
            </div>
            <div className="flex items-center justify-between text-sm">
              <div className="flex gap-3">
                <span>FG: {fgPct}%</span>
                <span>FT: {ftPct}%</span>
                <span>Fouls: {stats.fouls}</span>
              </div>
              <div className="flex items-center gap-2">
                <span className="font-bold">{formatTime(timeElapsed)}</span>
                <button
                  onClick={() => setIsPlaying(!isPlaying)}
                  className={`p-2 rounded-full ${isPlaying ? 'bg-red-500' : 'bg-green-500'}`}
                >
                  {isPlaying ? <Pause size={18} /> : <Play size={18} />}
                </button>
              </div>
            </div>
          </div>
        </div>

        <div className="flex-1 overflow-y-auto">
          <div className="max-w-md mx-auto p-3">
            {stats.fouls >= 5 && (
              <div className={`rounded-lg p-2 mb-3 text-center font-bold ${stats.fouls >= 6 ? 'bg-red-600 text-white' : 'bg-yellow-400 text-gray-800'}`}>
                {stats.fouls >= 6 ? 'üö´ FOULED OUT!' : '‚ö†Ô∏è 5 FOULS - CAUTION'}
              </div>
            )}

            {lastAction && (
              <div className="bg-blue-500 text-white rounded-lg p-3 mb-3 flex items-center justify-between">
                <span className="text-sm font-semibold">
                  Last: {lastAction.statName.replace(/([A-Z])/g, ' $1').trim()}
                </span>
                <button
                  onClick={undoLastAction}
                  className="bg-white text-blue-500 px-4 py-2 rounded-lg font-bold text-sm"
                >
                  Undo
                </button>
              </div>
            )}

            <div className="space-y-2">
              <div className="bg-white rounded-lg p-3 shadow">
                <div className="text-xs font-semibold text-gray-700 mb-2">Free Throws</div>
                <div className="grid grid-cols-2 gap-2">
                  <button
                    onClick={() => updateStat('freeThrowsMade', 1)}
                    className="bg-green-500 text-white p-3 rounded-lg font-bold active:bg-green-600"
                  >
                    ‚úì Made FT
                  </button>
                  <button
                    onClick={() => updateStat('freeThrowsMissed', 0)}
                    className="bg-red-500 text-white p-3 rounded-lg font-bold active:bg-red-600"
                  >
                    ‚úó Missed FT
                  </button>
                </div>
              </div>

              <div className="bg-white rounded-lg p-3 shadow">
                <div className="text-xs font-semibold text-gray-700 mb-2">2-Pointers</div>
                <div className="grid grid-cols-2 gap-2">
                  <button
                    onClick={() => updateStat('twoPointersMade', 2)}
                    className="bg-green-500 text-white p-3 rounded-lg font-bold active:bg-green-600"
                  >
                    ‚úì Made 2PT
                  </button>
                  <button
                    onClick={() => updateStat('twoPointersMissed', 0)}
                    className="bg-red-500 text-white p-3 rounded-lg font-bold active:bg-red-600"
                  >
                    ‚úó Missed 2PT
                  </button>
                </div>
              </div>

              <div className="bg-white rounded-lg p-3 shadow">
                <div className="text-xs font-semibold text-gray-700 mb-2">3-Pointers</div>
                <div className="grid grid-cols-2 gap-2">
                  <button
                    onClick={() => updateStat('threePointersMade', 3)}
                    className="bg-green-500 text-white p-3 rounded-lg font-bold active:bg-green-600"
                  >
                    ‚úì Made 3PT
                  </button>
                  <button
                    onClick={() => updateStat('threePointersMissed', 0)}
                    className="bg-red-500 text-white p-3 rounded-lg font-bold active:bg-red-600"
                  >
                    ‚úó Missed 3PT
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-2 gap-2">
                <button
                  onClick={() => updateStat('defensiveRebounds', 0)}
                  className="bg-blue-500 text-white p-3 rounded-lg font-bold active:bg-blue-600"
                >
                  Def Reb ({stats.defensiveRebounds})
                </button>
                <button
                  onClick={() => updateStat('offensiveRebounds', 0)}
                  className="bg-purple-500 text-white p-3 rounded-lg font-bold active:bg-purple-600"
                >
                  Off Reb ({stats.offensiveRebounds})
                </button>
              </div>

              <div className="grid grid-cols-2 gap-2">
                <button
                  onClick={() => updateStat('steals', 0)}
                  className="bg-indigo-500 text-white p-3 rounded-lg font-bold active:bg-indigo-600"
                >
                  Steal ({stats.steals})
                </button>
                <button
                  onClick={() => updateStat('blocks', 0)}
                  className="bg-pink-500 text-white p-3 rounded-lg font-bold active:bg-pink-600"
                >
                  Block ({stats.blocks})
                </button>
              </div>

              <div className="grid grid-cols-2 gap-2">
                <button
                  onClick={() => updateStat('turnovers', 0)}
                  className="bg-orange-500 text-white p-3 rounded-lg font-bold active:bg-orange-600"
                >
                  Turnover ({stats.turnovers})
                </button>
                <button
                  onClick={() => updateStat('fouls', 0)}
                  className="bg-yellow-500 text-gray-800 p-3 rounded-lg font-bold active:bg-yellow-600"
                >
                  Foul ({stats.fouls})
                </button>
              </div>

              <button
                onClick={endGame}
                className="w-full bg-red-600 text-white p-4 rounded-xl font-bold text-xl shadow-lg active:bg-red-700 mt-2"
              >
                End Game
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return null;
};

export default BasketballStatsTracker;